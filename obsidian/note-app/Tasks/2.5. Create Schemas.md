# Create Pydantic Schemas

## Prerequisites
- FastAPI and Pydantic installed
- Database models defined in `models.py`
- Project structure set up

## Steps

### 1. Create Base User Schemas
- [x] Create `backend/app/schemas.py` with base user schemas:
  ```python
  from pydantic import BaseModel, EmailStr
  from datetime import datetime
  from typing import Optional, List

  class UserBase(BaseModel):
      email: EmailStr

  class UserCreate(UserBase):
      password: str

  class User(UserBase):
      id: int
      is_active: bool
      created_at: datetime
      updated_at: Optional[datetime] = None

      class Config:
          from_attributes = True
  ```

### 2. Create Note Schemas
- [x] Add note schemas to `schemas.py`:
  ```python
  class NoteBase(BaseModel):
      title: str
      content: str

  class NoteCreate(NoteBase):
      pass

  class Note(NoteBase):
      id: int
      created_at: datetime
      updated_at: Optional[datetime] = None
      owner_id: int

      class Config:
          from_attributes = True
  ```

### 3. Add Response Models
- [x] Add user response model with notes relationship:
  ```python
  class UserWithNotes(User):
      notes: List[Note] = []

      class Config:
          from_attributes = True
  ```

### 4. Create Token Schemas
- [x] Add authentication token schemas:
  ```python
  class Token(BaseModel):
      access_token: str
      token_type: str

  class TokenData(BaseModel):
      email: Optional[str] = None
  ```

### 5. Verification Steps
- [x] Import schemas in `main.py`:
  ```python
  from . import schemas
  ```
- [x] Test schema validation with sample data
- [x] Verify all required fields are present
- [x] Check relationship mappings

## Schema Features
- **Email validation** using Pydantic's EmailStr
- **Automatic datetime handling**
- **Optional fields** where appropriate
- **SQLAlchemy model compatibility**
- **Token authentication support**

## Testing Checklist
- [x] User creation schema validation
- [x] Note creation schema validation
- [x] Response model serialization
- [x] Token schema functionality

## Next Steps
After completing this setup, proceed to:
- Implement authentication
- Develop CRUD operations
- Test API endpoints

## Notes
- Use appropriate field types for validation
- Consider adding field constraints
- Keep schemas focused and single-purpose
- Maintain consistency with database models

---

## Supporting Models

### Database Models in `models.py`
```python
from sqlalchemy import Boolean, Column, ForeignKey, Integer, String, Text, DateTime
from sqlalchemy.orm import relationship
from sqlalchemy.sql import func
from .database import Base

class User(Base):
    __tablename__ = "users"

    id = Column(Integer, primary_key=True, index=True)
    email = Column(String(255), unique=True, index=True)
    hashed_password = Column(String(255))
    is_active = Column(Boolean, default=True)
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), onupdate=func.now())

    # Relationship with Notes
    notes = relationship("Note", back_populates="owner", cascade="all, delete-orphan")

class Note(Base):
    __tablename__ = "notes"

    id = Column(Integer, primary_key=True, index=True)
    title = Column(String(255), index=True)
    content = Column(Text)
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), onupdate=func.now())
    owner_id = Column(Integer, ForeignKey("users.id"))

    # Relationship with User
    owner = relationship("User", back_populates="notes")
```

### FastAPI App Configuration in `main.py`
```python
from fastapi import FastAPI, Depends, HTTPException
from starlette.middleware.cors import CORSMiddleware
from sqlalchemy import text
from sqlalchemy.orm import Session
from .database import engine, Base, get_db
from . import models

# Create database tables
Base.metadata.create_all(bind=engine)

app = FastAPI(
    title="Notes API",
    description="API for managing personal notes",
    version="1.0.0"
)

# Configure CORS
origins = [
    "http://localhost:8080",  # Vue.js frontend URL
]

app.add_middleware(
    CORSMiddleware,
    allow_origins=origins,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

@app.get("/")
async def root():
    return {"message": "Welcome to Notes API"}

@app.get("/test-db")
async def test_db(db: Session = Depends(get_db)):
    try:
        db.execute(text("SELECT 1"))
        return {"message": "Database connection successful"}
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))
```
```
